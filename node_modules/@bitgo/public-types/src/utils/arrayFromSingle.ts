import * as t from "io-ts";
import { pipe } from "fp-ts/function";
import { chain } from "fp-ts/lib/Either";

export function arrayFromSingle<C extends t.Mixed>(
  codec: C,
  name: string = `ArrayFromSingle<${codec.name}>`,
) {
  return new t.Type(
    name,
    t.array(codec).is,
    (u, c) =>
      pipe(
        codec.validate(u, c),
        chain((as) => t.array(codec).validate([as], c)),
      ),
    t.identity,
  );
}
