"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getTransactionAmountsFromPsbt = void 0;
const transaction_1 = require("./transaction");
function getTransactionAmountsFromPsbt(psbt) {
    const inputCount = psbt.data.inputs.length;
    const outputCount = psbt.data.outputs.length;
    const txInputs = psbt.txInputs;
    const txOutputs = psbt.txOutputs;
    const inputAmount = psbt.data.inputs.reduce((acc, input, inputIndex) => {
        if (input.witnessUtxo) {
            return acc + BigInt(input.witnessUtxo.value);
        }
        else if (input.nonWitnessUtxo) {
            const tx = (0, transaction_1.createTransactionFromBuffer)(input.nonWitnessUtxo, psbt.network, { amountType: 'bigint' });
            return acc + tx.outs[txInputs[inputIndex].index].value;
        }
        else {
            throw new Error('missing witnessUtxo and nonWitnessUtxo');
        }
    }, BigInt(0));
    const outputAmount = psbt.data.outputs.reduce((acc, output, outputIndex) => acc + txOutputs[outputIndex].value, BigInt(0));
    const fee = inputAmount - outputAmount;
    return {
        inputCount,
        outputCount,
        inputAmount,
        outputAmount,
        fee,
    };
}
exports.getTransactionAmountsFromPsbt = getTransactionAmountsFromPsbt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNhY3Rpb25BbW91bnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2JpdGdvL3RyYW5zYWN0aW9uQW1vdW50cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwrQ0FBNEQ7QUFFNUQsU0FBZ0IsNkJBQTZCLENBQUMsSUFBYztJQU8xRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDM0MsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQzdDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDL0IsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUNqQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxFQUFFO1FBQ3JFLElBQUksS0FBSyxDQUFDLFdBQVcsRUFBRTtZQUNyQixPQUFPLEdBQUcsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM5QzthQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsRUFBRTtZQUMvQixNQUFNLEVBQUUsR0FBRyxJQUFBLHlDQUEyQixFQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3JHLE9BQU8sR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUN4RDthQUFNO1lBQ0wsTUFBTSxJQUFJLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1NBQzNEO0lBQ0gsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2QsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUMzQyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssRUFDaEUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUNWLENBQUM7SUFDRixNQUFNLEdBQUcsR0FBRyxXQUFXLEdBQUcsWUFBWSxDQUFDO0lBQ3ZDLE9BQU87UUFDTCxVQUFVO1FBQ1YsV0FBVztRQUNYLFdBQVc7UUFDWCxZQUFZO1FBQ1osR0FBRztLQUNKLENBQUM7QUFDSixDQUFDO0FBakNELHNFQWlDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFV0eG9Qc2J0IH0gZnJvbSAnLi9VdHhvUHNidCc7XG5pbXBvcnQgeyBjcmVhdGVUcmFuc2FjdGlvbkZyb21CdWZmZXIgfSBmcm9tICcuL3RyYW5zYWN0aW9uJztcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRyYW5zYWN0aW9uQW1vdW50c0Zyb21Qc2J0KHBzYnQ6IFV0eG9Qc2J0KToge1xuICBpbnB1dENvdW50OiBudW1iZXI7XG4gIG91dHB1dENvdW50OiBudW1iZXI7XG4gIGlucHV0QW1vdW50OiBiaWdpbnQ7XG4gIG91dHB1dEFtb3VudDogYmlnaW50O1xuICBmZWU6IGJpZ2ludDtcbn0ge1xuICBjb25zdCBpbnB1dENvdW50ID0gcHNidC5kYXRhLmlucHV0cy5sZW5ndGg7XG4gIGNvbnN0IG91dHB1dENvdW50ID0gcHNidC5kYXRhLm91dHB1dHMubGVuZ3RoO1xuICBjb25zdCB0eElucHV0cyA9IHBzYnQudHhJbnB1dHM7XG4gIGNvbnN0IHR4T3V0cHV0cyA9IHBzYnQudHhPdXRwdXRzO1xuICBjb25zdCBpbnB1dEFtb3VudCA9IHBzYnQuZGF0YS5pbnB1dHMucmVkdWNlKChhY2MsIGlucHV0LCBpbnB1dEluZGV4KSA9PiB7XG4gICAgaWYgKGlucHV0LndpdG5lc3NVdHhvKSB7XG4gICAgICByZXR1cm4gYWNjICsgQmlnSW50KGlucHV0LndpdG5lc3NVdHhvLnZhbHVlKTtcbiAgICB9IGVsc2UgaWYgKGlucHV0Lm5vbldpdG5lc3NVdHhvKSB7XG4gICAgICBjb25zdCB0eCA9IGNyZWF0ZVRyYW5zYWN0aW9uRnJvbUJ1ZmZlcihpbnB1dC5ub25XaXRuZXNzVXR4bywgcHNidC5uZXR3b3JrLCB7IGFtb3VudFR5cGU6ICdiaWdpbnQnIH0pO1xuICAgICAgcmV0dXJuIGFjYyArIHR4Lm91dHNbdHhJbnB1dHNbaW5wdXRJbmRleF0uaW5kZXhdLnZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3Npbmcgd2l0bmVzc1V0eG8gYW5kIG5vbldpdG5lc3NVdHhvJyk7XG4gICAgfVxuICB9LCBCaWdJbnQoMCkpO1xuICBjb25zdCBvdXRwdXRBbW91bnQgPSBwc2J0LmRhdGEub3V0cHV0cy5yZWR1Y2UoXG4gICAgKGFjYywgb3V0cHV0LCBvdXRwdXRJbmRleCkgPT4gYWNjICsgdHhPdXRwdXRzW291dHB1dEluZGV4XS52YWx1ZSxcbiAgICBCaWdJbnQoMClcbiAgKTtcbiAgY29uc3QgZmVlID0gaW5wdXRBbW91bnQgLSBvdXRwdXRBbW91bnQ7XG4gIHJldHVybiB7XG4gICAgaW5wdXRDb3VudCxcbiAgICBvdXRwdXRDb3VudCxcbiAgICBpbnB1dEFtb3VudCxcbiAgICBvdXRwdXRBbW91bnQsXG4gICAgZmVlLFxuICB9O1xufVxuIl19