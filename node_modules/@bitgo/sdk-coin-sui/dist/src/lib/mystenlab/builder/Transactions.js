"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Transactions = exports.getTransactionType = exports.TransactionType = exports.PublishTransaction = exports.MakeMoveVecTransaction = exports.MergeCoinsTransaction = exports.SplitCoinsTransaction = exports.TransferObjectsTransaction = exports.MoveCallTransaction = exports.PureTransactionArgument = exports.ObjectTransactionArgument = exports.TransactionArgument = exports.TransactionBlockInput = void 0;
const bcs_1 = require("@mysten/bcs");
const superstruct_1 = require("superstruct");
const common_1 = require("../types/common");
const utils_1 = require("./utils");
const option = (some) => (0, superstruct_1.union)([(0, superstruct_1.object)({ None: (0, superstruct_1.literal)(null) }), (0, superstruct_1.object)({ Some: some })]);
exports.TransactionBlockInput = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('Input'),
    index: (0, superstruct_1.integer)(),
    value: (0, superstruct_1.optional)((0, superstruct_1.any)()),
    type: (0, superstruct_1.optional)((0, superstruct_1.union)([(0, superstruct_1.literal)('pure'), (0, superstruct_1.literal)('object')])),
});
const TransactionArgumentTypes = [
    exports.TransactionBlockInput,
    (0, superstruct_1.object)({ kind: (0, superstruct_1.literal)('GasCoin') }),
    (0, superstruct_1.object)({ kind: (0, superstruct_1.literal)('Result'), index: (0, superstruct_1.integer)() }),
    (0, superstruct_1.object)({
        kind: (0, superstruct_1.literal)('NestedResult'),
        index: (0, superstruct_1.integer)(),
        resultIndex: (0, superstruct_1.integer)(),
    }),
];
// Generic transaction argument
exports.TransactionArgument = (0, superstruct_1.union)([...TransactionArgumentTypes]);
// Transaction argument referring to an object:
exports.ObjectTransactionArgument = (0, superstruct_1.union)([...TransactionArgumentTypes]);
exports.ObjectTransactionArgument[utils_1.TRANSACTION_TYPE] = {
    kind: 'object',
};
const PureTransactionArgument = (type) => {
    const struct = (0, superstruct_1.union)([...TransactionArgumentTypes]);
    struct[utils_1.TRANSACTION_TYPE] = {
        kind: 'pure',
        type,
    };
    return struct;
};
exports.PureTransactionArgument = PureTransactionArgument;
exports.MoveCallTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('MoveCall'),
    target: (0, superstruct_1.define)('target', (0, superstruct_1.string)().validator),
    typeArguments: (0, superstruct_1.array)((0, superstruct_1.string)()),
    arguments: (0, superstruct_1.array)(exports.TransactionArgument),
});
exports.TransferObjectsTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('TransferObjects'),
    objects: (0, superstruct_1.array)(exports.ObjectTransactionArgument),
    address: (0, exports.PureTransactionArgument)(bcs_1.BCS.ADDRESS),
});
exports.SplitCoinsTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('SplitCoins'),
    coin: exports.ObjectTransactionArgument,
    amounts: (0, superstruct_1.array)((0, exports.PureTransactionArgument)('u64')),
});
exports.MergeCoinsTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('MergeCoins'),
    destination: exports.ObjectTransactionArgument,
    sources: (0, superstruct_1.array)(exports.ObjectTransactionArgument),
});
exports.MakeMoveVecTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('MakeMoveVec'),
    type: (0, superstruct_1.optional)(option((0, superstruct_1.string)())),
    objects: (0, superstruct_1.array)(exports.ObjectTransactionArgument),
});
exports.PublishTransaction = (0, superstruct_1.object)({
    kind: (0, superstruct_1.literal)('Publish'),
    modules: (0, superstruct_1.array)((0, superstruct_1.array)((0, superstruct_1.integer)())),
    dependencies: (0, superstruct_1.array)(common_1.ObjectId),
});
const TransactionTypes = [
    exports.MoveCallTransaction,
    exports.TransferObjectsTransaction,
    exports.SplitCoinsTransaction,
    exports.MergeCoinsTransaction,
    exports.PublishTransaction,
    exports.MakeMoveVecTransaction,
];
exports.TransactionType = (0, superstruct_1.union)([...TransactionTypes]);
function getTransactionType(data) {
    (0, superstruct_1.assert)(data, exports.TransactionType);
    return TransactionTypes.find((schema) => (0, superstruct_1.is)(data, schema));
}
exports.getTransactionType = getTransactionType;
/**
 * Simple helpers used to construct transactions:
 */
exports.Transactions = {
    MoveCall(input) {
        var _a, _b;
        return (0, utils_1.create)({
            kind: 'MoveCall',
            target: input.target,
            arguments: (_a = input.arguments) !== null && _a !== void 0 ? _a : [],
            typeArguments: (_b = input.typeArguments) !== null && _b !== void 0 ? _b : [],
        }, exports.MoveCallTransaction);
    },
    TransferObjects(objects, address) {
        return (0, utils_1.create)({ kind: 'TransferObjects', objects, address }, exports.TransferObjectsTransaction);
    },
    SplitCoins(coin, amounts) {
        return (0, utils_1.create)({ kind: 'SplitCoins', coin, amounts }, exports.SplitCoinsTransaction);
    },
    MergeCoins(destination, sources) {
        return (0, utils_1.create)({ kind: 'MergeCoins', destination, sources }, exports.MergeCoinsTransaction);
    },
    Publish(modules, dependencies) {
        return (0, utils_1.create)({ kind: 'Publish', modules, dependencies }, exports.PublishTransaction);
    },
    MakeMoveVec({ type, objects, }) {
        return (0, utils_1.create)({
            kind: 'MakeMoveVec',
            type: type ? { Some: type } : { None: null },
            objects,
        }, exports.MakeMoveVecTransaction);
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhbnNhY3Rpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9teXN0ZW5sYWIvYnVpbGRlci9UcmFuc2FjdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQWtDO0FBQ2xDLDZDQWNxQjtBQUNyQiw0Q0FBMkM7QUFDM0MsbUNBQXNFO0FBRXRFLE1BQU0sTUFBTSxHQUFHLENBQTZCLElBQU8sRUFBRSxFQUFFLENBQ3JELElBQUEsbUJBQUssRUFBQyxDQUFDLElBQUEsb0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxJQUFBLHFCQUFPLEVBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUEsb0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUV0RCxRQUFBLHFCQUFxQixHQUFHLElBQUEsb0JBQU0sRUFBQztJQUMxQyxJQUFJLEVBQUUsSUFBQSxxQkFBTyxFQUFDLE9BQU8sQ0FBQztJQUN0QixLQUFLLEVBQUUsSUFBQSxxQkFBTyxHQUFFO0lBQ2hCLEtBQUssRUFBRSxJQUFBLHNCQUFRLEVBQUMsSUFBQSxpQkFBRyxHQUFFLENBQUM7SUFDdEIsSUFBSSxFQUFFLElBQUEsc0JBQVEsRUFBQyxJQUFBLG1CQUFLLEVBQUMsQ0FBQyxJQUFBLHFCQUFPLEVBQUMsTUFBTSxDQUFDLEVBQUUsSUFBQSxxQkFBTyxFQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUM1RCxDQUFDLENBQUM7QUFHSCxNQUFNLHdCQUF3QixHQUFHO0lBQy9CLDZCQUFxQjtJQUNyQixJQUFBLG9CQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsSUFBQSxxQkFBTyxFQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7SUFDcEMsSUFBQSxvQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLElBQUEscUJBQU8sRUFBQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFB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LE9BQU8sSUFBQSxjQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsRUFBRSw2QkFBcUIsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFDRCxVQUFVLENBQUMsV0FBZ0MsRUFBRSxPQUE4QjtRQUN6RSxPQUFPLElBQUEsY0FBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLEVBQUUsNkJBQXFCLENBQUMsQ0FBQztJQUNyRixDQUFDO0lBQ0QsT0FBTyxDQUFDLE9BQW1CLEVBQUUsWUFBd0I7UUFDbkQsT0FBTyxJQUFBLGNBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxFQUFFLDBCQUFrQixDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUNELFdBQVcsQ0FBQyxFQUNWLElBQUksRUFDSixPQUFPLEdBR1I7UUFDQyxPQUFPLElBQUEsY0FBTSxFQUNYO1lBQ0UsSUFBSSxFQUFFLGFBQWE7WUFDbkIsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtZQUM1QyxPQUFPO1NBQ1IsRUFDRCw4QkFBc0IsQ0FDdkIsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQkNTIH0gZnJvbSAnQG15c3Rlbi9iY3MnO1xuaW1wb3J0IHtcbiAgaXMsXG4gIGFueSxcbiAgYXJyYXksXG4gIEluZmVyLFxuICBpbnRlZ2VyLFxuICBsaXRlcmFsLFxuICBvYmplY3QsXG4gIG9wdGlvbmFsLFxuICBzdHJpbmcsXG4gIHVuaW9uLFxuICBhc3NlcnQsXG4gIFN0cnVjdCxcbiAgZGVmaW5lLFxufSBmcm9tICdzdXBlcnN0cnVjdCc7XG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gJy4uL3R5cGVzL2NvbW1vbic7XG5pbXBvcnQgeyBUUkFOU0FDVElPTl9UWVBFLCBXZWxsS25vd25FbmNvZGluZywgY3JlYXRlIH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IG9wdGlvbiA9IDxUIGV4dGVuZHMgU3RydWN0PGFueSwgYW55Pj4oc29tZTogVCkgPT5cbiAgdW5pb24oW29iamVjdCh7IE5vbmU6IGxpdGVyYWwobnVsbCkgfSksIG9iamVjdCh7IFNvbWU6IHNvbWUgfSldKTtcblxuZXhwb3J0IGNvbnN0IFRyYW5zYWN0aW9uQmxvY2tJbnB1dCA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ0lucHV0JyksXG4gIGluZGV4OiBpbnRlZ2VyKCksXG4gIHZhbHVlOiBvcHRpb25hbChhbnkoKSksXG4gIHR5cGU6IG9wdGlvbmFsKHVuaW9uKFtsaXRlcmFsKCdwdXJlJyksIGxpdGVyYWwoJ29iamVjdCcpXSkpLFxufSk7XG5leHBvcnQgdHlwZSBUcmFuc2FjdGlvbkJsb2NrSW5wdXQgPSBJbmZlcjx0eXBlb2YgVHJhbnNhY3Rpb25CbG9ja0lucHV0PjtcblxuY29uc3QgVHJhbnNhY3Rpb25Bcmd1bWVudFR5cGVzID0gW1xuICBUcmFuc2FjdGlvbkJsb2NrSW5wdXQsXG4gIG9iamVjdCh7IGtpbmQ6IGxpdGVyYWwoJ0dhc0NvaW4nKSB9KSxcbiAgb2JqZWN0KHsga2luZDogbGl0ZXJhbCgnUmVzdWx0JyksIGluZGV4OiBpbnRlZ2VyKCkgfSksXG4gIG9iamVjdCh7XG4gICAga2luZDogbGl0ZXJhbCgnTmVzdGVkUmVzdWx0JyksXG4gICAgaW5kZXg6IGludGVnZXIoKSxcbiAgICByZXN1bHRJbmRleDogaW50ZWdlcigpLFxuICB9KSxcbl0gYXMgY29uc3Q7XG5cbi8vIEdlbmVyaWMgdHJhbnNhY3Rpb24gYXJndW1lbnRcbmV4cG9ydCBjb25zdCBUcmFuc2FjdGlvbkFyZ3VtZW50ID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uQXJndW1lbnRUeXBlc10pO1xuZXhwb3J0IHR5cGUgVHJhbnNhY3Rpb25Bcmd1bWVudCA9IEluZmVyPHR5cGVvZiBUcmFuc2FjdGlvbkFyZ3VtZW50PjtcblxuLy8gVHJhbnNhY3Rpb24gYXJndW1lbnQgcmVmZXJyaW5nIHRvIGFuIG9iamVjdDpcbmV4cG9ydCBjb25zdCBPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50ID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uQXJndW1lbnRUeXBlc10pO1xuKE9iamVjdFRyYW5zYWN0aW9uQXJndW1lbnQgYXMgYW55KVtUUkFOU0FDVElPTl9UWVBFXSA9IHtcbiAga2luZDogJ29iamVjdCcsXG59IGFzIFdlbGxLbm93bkVuY29kaW5nO1xuXG5leHBvcnQgY29uc3QgUHVyZVRyYW5zYWN0aW9uQXJndW1lbnQgPSAodHlwZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHN0cnVjdCA9IHVuaW9uKFsuLi5UcmFuc2FjdGlvbkFyZ3VtZW50VHlwZXNdKTtcbiAgKHN0cnVjdCBhcyBhbnkpW1RSQU5TQUNUSU9OX1RZUEVdID0ge1xuICAgIGtpbmQ6ICdwdXJlJyxcbiAgICB0eXBlLFxuICB9IGFzIFdlbGxLbm93bkVuY29kaW5nO1xuICByZXR1cm4gc3RydWN0O1xufTtcblxuZXhwb3J0IGNvbnN0IE1vdmVDYWxsVHJhbnNhY3Rpb24gPSBvYmplY3Qoe1xuICBraW5kOiBsaXRlcmFsKCdNb3ZlQ2FsbCcpLFxuICB0YXJnZXQ6IGRlZmluZTxgJHtzdHJpbmd9Ojoke3N0cmluZ306OiR7c3RyaW5nfWA+KCd0YXJnZXQnLCBzdHJpbmcoKS52YWxpZGF0b3IpLFxuICB0eXBlQXJndW1lbnRzOiBhcnJheShzdHJpbmcoKSksXG4gIGFyZ3VtZW50czogYXJyYXkoVHJhbnNhY3Rpb25Bcmd1bWVudCksXG59KTtcbmV4cG9ydCB0eXBlIE1vdmVDYWxsVHJhbnNhY3Rpb24gPSBJbmZlcjx0eXBlb2YgTW92ZUNhbGxUcmFuc2FjdGlvbj47XG5cbmV4cG9ydCBjb25zdCBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ1RyYW5zZmVyT2JqZWN0cycpLFxuICBvYmplY3RzOiBhcnJheShPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50KSxcbiAgYWRkcmVzczogUHVyZVRyYW5zYWN0aW9uQXJndW1lbnQoQkNTLkFERFJFU1MpLFxufSk7XG5leHBvcnQgdHlwZSBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBUcmFuc2Zlck9iamVjdHNUcmFuc2FjdGlvbj47XG5cbmV4cG9ydCBjb25zdCBTcGxpdENvaW5zVHJhbnNhY3Rpb24gPSBvYmplY3Qoe1xuICBraW5kOiBsaXRlcmFsKCdTcGxpdENvaW5zJyksXG4gIGNvaW46IE9iamVjdFRyYW5zYWN0aW9uQXJndW1lbnQsXG4gIGFtb3VudHM6IGFycmF5KFB1cmVUcmFuc2FjdGlvbkFyZ3VtZW50KCd1NjQnKSksXG59KTtcbmV4cG9ydCB0eXBlIFNwbGl0Q29pbnNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBTcGxpdENvaW5zVHJhbnNhY3Rpb24+O1xuXG5leHBvcnQgY29uc3QgTWVyZ2VDb2luc1RyYW5zYWN0aW9uID0gb2JqZWN0KHtcbiAga2luZDogbGl0ZXJhbCgnTWVyZ2VDb2lucycpLFxuICBkZXN0aW5hdGlvbjogT2JqZWN0VHJhbnNhY3Rpb25Bcmd1bWVudCxcbiAgc291cmNlczogYXJyYXkoT2JqZWN0VHJhbnNhY3Rpb25Bcmd1bWVudCksXG59KTtcbmV4cG9ydCB0eXBlIE1lcmdlQ29pbnNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBNZXJnZUNvaW5zVHJhbnNhY3Rpb24+O1xuXG5leHBvcnQgY29uc3QgTWFrZU1vdmVWZWNUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ01ha2VNb3ZlVmVjJyksXG4gIHR5cGU6IG9wdGlvbmFsKG9wdGlvbihzdHJpbmcoKSkpLFxuICBvYmplY3RzOiBhcnJheShPYmplY3RUcmFuc2FjdGlvbkFyZ3VtZW50KSxcbn0pO1xuZXhwb3J0IHR5cGUgTWFrZU1vdmVWZWNUcmFuc2FjdGlvbiA9IEluZmVyPHR5cGVvZiBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uPjtcblxuZXhwb3J0IGNvbnN0IFB1Ymxpc2hUcmFuc2FjdGlvbiA9IG9iamVjdCh7XG4gIGtpbmQ6IGxpdGVyYWwoJ1B1Ymxpc2gnKSxcbiAgbW9kdWxlczogYXJyYXkoYXJyYXkoaW50ZWdlcigpKSksXG4gIGRlcGVuZGVuY2llczogYXJyYXkoT2JqZWN0SWQpLFxufSk7XG5leHBvcnQgdHlwZSBQdWJsaXNoVHJhbnNhY3Rpb24gPSBJbmZlcjx0eXBlb2YgUHVibGlzaFRyYW5zYWN0aW9uPjtcblxuY29uc3QgVHJhbnNhY3Rpb25UeXBlcyA9IFtcbiAgTW92ZUNhbGxUcmFuc2FjdGlvbixcbiAgVHJhbnNmZXJPYmplY3RzVHJhbnNhY3Rpb24sXG4gIFNwbGl0Q29pbnNUcmFuc2FjdGlvbixcbiAgTWVyZ2VDb2luc1RyYW5zYWN0aW9uLFxuICBQdWJsaXNoVHJhbnNhY3Rpb24sXG4gIE1ha2VNb3ZlVmVjVHJhbnNhY3Rpb24sXG5dIGFzIGNvbnN0O1xuXG5leHBvcnQgY29uc3QgVHJhbnNhY3Rpb25UeXBlID0gdW5pb24oWy4uLlRyYW5zYWN0aW9uVHlwZXNdKTtcbmV4cG9ydCB0eXBlIFRyYW5zYWN0aW9uVHlwZSA9IEluZmVyPHR5cGVvZiBUcmFuc2FjdGlvblR5cGU+O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25UeXBlKGRhdGE6IHVua25vd24pIHtcbiAgYXNzZXJ0KGRhdGEsIFRyYW5zYWN0aW9uVHlwZSk7XG4gIHJldHVybiBUcmFuc2FjdGlvblR5cGVzLmZpbmQoKHNjaGVtYSkgPT4gaXMoZGF0YSwgc2NoZW1hIGFzIFN0cnVjdCkpITtcbn1cblxuLyoqXG4gKiBTaW1wbGUgaGVscGVycyB1c2VkIHRvIGNvbnN0cnVjdCB0cmFuc2FjdGlvbnM6XG4gKi9cbmV4cG9ydCBjb25zdCBUcmFuc2FjdGlvbnMgPSB7XG4gIE1vdmVDYWxsKFxuICAgIGlucHV0OiBPbWl0PE1vdmVDYWxsVHJhbnNhY3Rpb24sICdraW5kJyB8ICdhcmd1bWVudHMnIHwgJ3R5cGVBcmd1bWVudHMnPiAmIHtcbiAgICAgIGFyZ3VtZW50cz86IFRyYW5zYWN0aW9uQXJndW1lbnRbXTtcbiAgICAgIHR5cGVBcmd1bWVudHM/OiBzdHJpbmdbXTtcbiAgICB9XG4gICk6IE1vdmVDYWxsVHJhbnNhY3Rpb24ge1xuICAgIHJldHVybiBjcmVhdGUoXG4gICAgICB7XG4gICAgICAgIGtpbmQ6ICdNb3ZlQ2FsbCcsXG4gICAgICAgIHRhcmdldDogaW5wdXQudGFyZ2V0LFxuICAgICAgICBhcmd1bWVudHM6IGlucHV0LmFyZ3VtZW50cyA/PyBbXSxcbiAgICAgICAgdHlwZUFyZ3VtZW50czogaW5wdXQudHlwZUFyZ3VtZW50cyA/PyBbXSxcbiAgICAgIH0sXG4gICAgICBNb3ZlQ2FsbFRyYW5zYWN0aW9uXG4gICAgKTtcbiAgfSxcbiAgVHJhbnNmZXJPYmplY3RzKG9iamVjdHM6IFRyYW5zYWN0aW9uQXJndW1lbnRbXSwgYWRkcmVzczogVHJhbnNhY3Rpb25Bcmd1bWVudCk6IFRyYW5zZmVyT2JqZWN0c1RyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKHsga2luZDogJ1RyYW5zZmVyT2JqZWN0cycsIG9iamVjdHMsIGFkZHJlc3MgfSwgVHJhbnNmZXJPYmplY3RzVHJhbnNhY3Rpb24pO1xuICB9LFxuICBTcGxpdENvaW5zKGNvaW46IFRyYW5zYWN0aW9uQXJndW1lbnQsIGFtb3VudHM6IFRyYW5zYWN0aW9uQXJndW1lbnRbXSk6IFNwbGl0Q29pbnNUcmFuc2FjdGlvbiB7XG4gICAgcmV0dXJuIGNyZWF0ZSh7IGtpbmQ6ICdTcGxpdENvaW5zJywgY29pbiwgYW1vdW50cyB9LCBTcGxpdENvaW5zVHJhbnNhY3Rpb24pO1xuICB9LFxuICBNZXJnZUNvaW5zKGRlc3RpbmF0aW9uOiBUcmFuc2FjdGlvbkFyZ3VtZW50LCBzb3VyY2VzOiBUcmFuc2FjdGlvbkFyZ3VtZW50W10pOiBNZXJnZUNvaW5zVHJhbnNhY3Rpb24ge1xuICAgIHJldHVybiBjcmVhdGUoeyBraW5kOiAnTWVyZ2VDb2lucycsIGRlc3RpbmF0aW9uLCBzb3VyY2VzIH0sIE1lcmdlQ29pbnNUcmFuc2FjdGlvbik7XG4gIH0sXG4gIFB1Ymxpc2gobW9kdWxlczogbnVtYmVyW11bXSwgZGVwZW5kZW5jaWVzOiBPYmplY3RJZFtdKTogUHVibGlzaFRyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKHsga2luZDogJ1B1Ymxpc2gnLCBtb2R1bGVzLCBkZXBlbmRlbmNpZXMgfSwgUHVibGlzaFRyYW5zYWN0aW9uKTtcbiAgfSxcbiAgTWFrZU1vdmVWZWMoe1xuICAgIHR5cGUsXG4gICAgb2JqZWN0cyxcbiAgfTogT21pdDxNYWtlTW92ZVZlY1RyYW5zYWN0aW9uLCAna2luZCcgfCAndHlwZSc+ICYge1xuICAgIHR5cGU/OiBzdHJpbmc7XG4gIH0pOiBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uIHtcbiAgICByZXR1cm4gY3JlYXRlKFxuICAgICAge1xuICAgICAgICBraW5kOiAnTWFrZU1vdmVWZWMnLFxuICAgICAgICB0eXBlOiB0eXBlID8geyBTb21lOiB0eXBlIH0gOiB7IE5vbmU6IG51bGwgfSxcbiAgICAgICAgb2JqZWN0cyxcbiAgICAgIH0sXG4gICAgICBNYWtlTW92ZVZlY1RyYW5zYWN0aW9uXG4gICAgKTtcbiAgfSxcbn07XG4iXX0=