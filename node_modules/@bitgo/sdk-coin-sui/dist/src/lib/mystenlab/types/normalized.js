"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractStructTag = exports.extractReference = exports.extractMutableReference = exports.SuiMoveNormalizedModules = exports.SuiMoveNormalizedModule = exports.SuiMoveNormalizedStruct = exports.SuiMoveNormalizedField = exports.SuiMoveNormalizedFunction = exports.SuiMoveNormalizedStructType = exports.SuiMoveNormalizedType = exports.SuiMoveNormalizedTypeParameterType = exports.SuiMoveStructTypeParameter = exports.SuiMoveAbilitySet = exports.SuiMoveVisibility = exports.SuiMoveModuleId = exports.SuiMoveFunctionArgTypes = exports.SuiMoveFunctionArgType = void 0;
const superstruct_1 = require("superstruct");
exports.SuiMoveFunctionArgType = (0, superstruct_1.union)([(0, superstruct_1.string)(), (0, superstruct_1.object)({ Object: (0, superstruct_1.string)() })]);
exports.SuiMoveFunctionArgTypes = (0, superstruct_1.array)(exports.SuiMoveFunctionArgType);
exports.SuiMoveModuleId = (0, superstruct_1.object)({
    address: (0, superstruct_1.string)(),
    name: (0, superstruct_1.string)(),
});
exports.SuiMoveVisibility = (0, superstruct_1.union)([(0, superstruct_1.literal)('Private'), (0, superstruct_1.literal)('Public'), (0, superstruct_1.literal)('Friend')]);
exports.SuiMoveAbilitySet = (0, superstruct_1.object)({
    abilities: (0, superstruct_1.array)((0, superstruct_1.string)()),
});
exports.SuiMoveStructTypeParameter = (0, superstruct_1.object)({
    constraints: exports.SuiMoveAbilitySet,
    isPhantom: (0, superstruct_1.boolean)(),
});
exports.SuiMoveNormalizedTypeParameterType = (0, superstruct_1.object)({
    TypeParameter: (0, superstruct_1.number)(),
});
function isSuiMoveNormalizedType(value) {
    if (!value)
        return false;
    if (typeof value === 'string')
        return true;
    if ((0, superstruct_1.is)(value, exports.SuiMoveNormalizedTypeParameterType))
        return true;
    if (isSuiMoveNormalizedStructType(value))
        return true;
    if (typeof value !== 'object')
        return false;
    const valueProperties = value;
    if ((0, superstruct_1.is)(valueProperties.Reference, exports.SuiMoveNormalizedType))
        return true;
    if ((0, superstruct_1.is)(valueProperties.MutableReference, exports.SuiMoveNormalizedType))
        return true;
    if ((0, superstruct_1.is)(valueProperties.Vector, exports.SuiMoveNormalizedType))
        return true;
    return false;
}
exports.SuiMoveNormalizedType = (0, superstruct_1.define)('SuiMoveNormalizedType', isSuiMoveNormalizedType);
function isSuiMoveNormalizedStructType(value) {
    if (!value || typeof value !== 'object')
        return false;
    const valueProperties = value;
    if (!valueProperties.Struct || typeof valueProperties.Struct !== 'object')
        return false;
    const structProperties = valueProperties.Struct;
    if (typeof structProperties.address !== 'string' ||
        typeof structProperties.module !== 'string' ||
        typeof structProperties.name !== 'string' ||
        !Array.isArray(structProperties.typeArguments) ||
        !structProperties.typeArguments.every((value) => isSuiMoveNormalizedType(value))) {
        return false;
    }
    return true;
}
// NOTE: This type is recursive, so we need to manually implement it:
exports.SuiMoveNormalizedStructType = (0, superstruct_1.define)('SuiMoveNormalizedStructType', isSuiMoveNormalizedStructType);
exports.SuiMoveNormalizedFunction = (0, superstruct_1.object)({
    visibility: exports.SuiMoveVisibility,
    isEntry: (0, superstruct_1.boolean)(),
    typeParameters: (0, superstruct_1.array)(exports.SuiMoveAbilitySet),
    parameters: (0, superstruct_1.array)(exports.SuiMoveNormalizedType),
    return: (0, superstruct_1.array)(exports.SuiMoveNormalizedType),
});
exports.SuiMoveNormalizedField = (0, superstruct_1.object)({
    name: (0, superstruct_1.string)(),
    type: exports.SuiMoveNormalizedType,
});
exports.SuiMoveNormalizedStruct = (0, superstruct_1.object)({
    abilities: exports.SuiMoveAbilitySet,
    typeParameters: (0, superstruct_1.array)(exports.SuiMoveStructTypeParameter),
    fields: (0, superstruct_1.array)(exports.SuiMoveNormalizedField),
});
exports.SuiMoveNormalizedModule = (0, superstruct_1.object)({
    fileFormatVersion: (0, superstruct_1.number)(),
    address: (0, superstruct_1.string)(),
    name: (0, superstruct_1.string)(),
    friends: (0, superstruct_1.array)(exports.SuiMoveModuleId),
    structs: (0, superstruct_1.record)((0, superstruct_1.string)(), exports.SuiMoveNormalizedStruct),
    exposedFunctions: (0, superstruct_1.record)((0, superstruct_1.string)(), exports.SuiMoveNormalizedFunction),
});
exports.SuiMoveNormalizedModules = (0, superstruct_1.record)((0, superstruct_1.string)(), exports.SuiMoveNormalizedModule);
function extractMutableReference(normalizedType) {
    return typeof normalizedType === 'object' && 'MutableReference' in normalizedType
        ? normalizedType.MutableReference
        : undefined;
}
exports.extractMutableReference = extractMutableReference;
function extractReference(normalizedType) {
    return typeof normalizedType === 'object' && 'Reference' in normalizedType ? normalizedType.Reference : undefined;
}
exports.extractReference = extractReference;
function extractStructTag(normalizedType) {
    if (typeof normalizedType === 'object' && 'Struct' in normalizedType) {
        return normalizedType;
    }
    const ref = extractReference(normalizedType);
    const mutRef = extractMutableReference(normalizedType);
    if (typeof ref === 'object' && 'Struct' in ref) {
        return ref;
    }
    if (typeof mutRef === 'object' && 'Struct' in mutRef) {
        return mutRef;
    }
    return undefined;
}
exports.extractStructTag = extractStructTag;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9ybWFsaXplZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvbXlzdGVubGFiL3R5cGVzL25vcm1hbGl6ZWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQWdIO0FBSW5HLFFBQUEsc0JBQXNCLEdBQUcsSUFBQSxtQkFBSyxFQUFDLENBQUMsSUFBQSxvQkFBTSxHQUFFLEVBQUUsSUFBQSxvQkFBTSxFQUFDLEVBQUUsTUFBTSxFQUFFLElBQUEsb0JBQU0sR0FBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFekUsUUFBQSx1QkFBdUIsR0FBRyxJQUFBLG1CQUFLLEVBQUMsOEJBQXNCLENBQUMsQ0FBQztBQUd4RCxRQUFBLGVBQWUsR0FBRyxJQUFBLG9CQUFNLEVBQUM7SUFDcEMsT0FBTyxFQUFFLElBQUEsb0JBQU0sR0FBRTtJQUNqQixJQUFJLEVBQUUsSUFBQSxvQkFBTSxHQUFFO0NBQ2YsQ0FBQyxDQUFDO0FBR1UsUUFBQSxpQkFBaUIsR0FBRyxJQUFBLG1CQUFLLEVBQUMsQ0FBQyxJQUFBLHFCQUFPLEVBQUMsU0FBUyxDQUFDLEVBQUUsSUFBQSxxQkFBTyxFQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUEscUJBQU8sRUFBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFHdEYsUUFBQSxpQkFBaUIsR0FBRyxJQUFBLG9CQUFNLEVBQUM7SUFDdEMsU0FBUyxFQUFFLElBQUEsbUJBQUssRUFBQyxJQUFBLG9CQUFNLEdBQUUsQ0FBQztDQUMzQixDQUFDLENBQUM7QUFHVSxRQUFBLDBCQUEwQixHQUFHLElBQUEsb0JBQU0sRUFBQztJQUMvQyxXQUFXLEVBQUUseUJBQWlCO0lBQzlCLFNBQVMsRUFBRSxJQUFBLHFCQUFPLEdBQUU7Q0FDckIsQ0FBQyxDQUFDO0FBR1UsUUFBQSxrQ0FBa0MsR0FBRyxJQUFBLG9CQUFNLEVBQUM7SUFDdkQsYUFBYSxFQUFFLElBQUEsb0JBQU0sR0FBRTtD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QU0sR0FBRyxHQUFHLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sTUFBTSxHQUFHLHVCQUF1QixDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBRXZELElBQUksT0FBTyxHQUFHLEtBQUssUUFBUSxJQUFJLFFBQVEsSUFBSSxHQUFHLEVBQUU7UUFDOUMsT0FBTyxHQUFHLENBQUM7S0FDWjtJQUVELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLFFBQVEsSUFBSSxNQUFNLEVBQUU7UUFDcEQsT0FBTyxNQUFNLENBQUM7S0FDZjtJQUNELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFoQkQsNENBZ0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXJyYXksIEluZmVyLCBvYmplY3QsIHN0cmluZywgdW5pb24sIGJvb2xlYW4sIGRlZmluZSwgbnVtYmVyLCBsaXRlcmFsLCByZWNvcmQsIGlzIH0gZnJvbSAnc3VwZXJzdHJ1Y3QnO1xuXG5leHBvcnQgdHlwZSBTdWlNb3ZlRnVuY3Rpb25BcmdUeXBlc1Jlc3BvbnNlID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVGdW5jdGlvbkFyZ1R5cGU+W107XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlRnVuY3Rpb25BcmdUeXBlID0gdW5pb24oW3N0cmluZygpLCBvYmplY3QoeyBPYmplY3Q6IHN0cmluZygpIH0pXSk7XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlRnVuY3Rpb25BcmdUeXBlcyA9IGFycmF5KFN1aU1vdmVGdW5jdGlvbkFyZ1R5cGUpO1xuZXhwb3J0IHR5cGUgU3VpTW92ZUZ1bmN0aW9uQXJnVHlwZXMgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZUZ1bmN0aW9uQXJnVHlwZXM+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZU1vZHVsZUlkID0gb2JqZWN0KHtcbiAgYWRkcmVzczogc3RyaW5nKCksXG4gIG5hbWU6IHN0cmluZygpLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTW9kdWxlSWQgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZU1vZHVsZUlkPjtcblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVWaXNpYmlsaXR5ID0gdW5pb24oW2xpdGVyYWwoJ1ByaXZhdGUnKSwgbGl0ZXJhbCgnUHVibGljJyksIGxpdGVyYWwoJ0ZyaWVuZCcpXSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlVmlzaWJpbGl0eSA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlVmlzaWJpbGl0eT47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlQWJpbGl0eVNldCA9IG9iamVjdCh7XG4gIGFiaWxpdGllczogYXJyYXkoc3RyaW5nKCkpLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlQWJpbGl0eVNldCA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlQWJpbGl0eVNldD47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlU3RydWN0VHlwZVBhcmFtZXRlciA9IG9iamVjdCh7XG4gIGNvbnN0cmFpbnRzOiBTdWlNb3ZlQWJpbGl0eVNldCxcbiAgaXNQaGFudG9tOiBib29sZWFuKCksXG59KTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVTdHJ1Y3RUeXBlUGFyYW1ldGVyID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVTdHJ1Y3RUeXBlUGFyYW1ldGVyPjtcblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVOb3JtYWxpemVkVHlwZVBhcmFtZXRlclR5cGUgPSBvYmplY3Qoe1xuICBUeXBlUGFyYW1ldGVyOiBudW1iZXIoKSxcbn0pO1xuZXhwb3J0IHR5cGUgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlUGFyYW1ldGVyVHlwZSA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlTm9ybWFsaXplZFR5cGVQYXJhbWV0ZXJUeXBlPjtcblxuZXhwb3J0IHR5cGUgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlID1cbiAgfCBzdHJpbmdcbiAgfCBTdWlNb3ZlTm9ybWFsaXplZFR5cGVQYXJhbWV0ZXJUeXBlXG4gIHwgeyBSZWZlcmVuY2U6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSB9XG4gIHwgeyBNdXRhYmxlUmVmZXJlbmNlOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUgfVxuICB8IHsgVmVjdG9yOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUgfVxuICB8IFN1aU1vdmVOb3JtYWxpemVkU3RydWN0VHlwZTtcblxuZnVuY3Rpb24gaXNTdWlNb3ZlTm9ybWFsaXplZFR5cGUodmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBTdWlNb3ZlTm9ybWFsaXplZFR5cGUge1xuICBpZiAoIXZhbHVlKSByZXR1cm4gZmFsc2U7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSByZXR1cm4gdHJ1ZTtcbiAgaWYgKGlzKHZhbHVlLCBTdWlNb3ZlTm9ybWFsaXplZFR5cGVQYXJhbWV0ZXJUeXBlKSkgcmV0dXJuIHRydWU7XG4gIGlmIChpc1N1aU1vdmVOb3JtYWxpemVkU3RydWN0VHlwZSh2YWx1ZSkpIHJldHVybiB0cnVlO1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlO1xuXG4gIGNvbnN0IHZhbHVlUHJvcGVydGllcyA9IHZhbHVlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBpZiAoaXModmFsdWVQcm9wZXJ0aWVzLlJlZmVyZW5jZSwgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKSkgcmV0dXJuIHRydWU7XG4gIGlmIChpcyh2YWx1ZVByb3BlcnRpZXMuTXV0YWJsZVJlZmVyZW5jZSwgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKSkgcmV0dXJuIHRydWU7XG4gIGlmIChpcyh2YWx1ZVByb3BlcnRpZXMuVmVjdG9yLCBTdWlNb3ZlTm9ybWFsaXplZFR5cGUpKSByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgY29uc3QgU3VpTW92ZU5vcm1hbGl6ZWRUeXBlID0gZGVmaW5lPFN1aU1vdmVOb3JtYWxpemVkVHlwZT4oJ1N1aU1vdmVOb3JtYWxpemVkVHlwZScsIGlzU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKTtcblxuZXhwb3J0IHR5cGUgU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlID0ge1xuICBTdHJ1Y3Q6IHtcbiAgICBhZGRyZXNzOiBzdHJpbmc7XG4gICAgbW9kdWxlOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIHR5cGVBcmd1bWVudHM6IFN1aU1vdmVOb3JtYWxpemVkVHlwZVtdO1xuICB9O1xufTtcblxuZnVuY3Rpb24gaXNTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGUodmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGUge1xuICBpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTtcblxuICBjb25zdCB2YWx1ZVByb3BlcnRpZXMgPSB2YWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgaWYgKCF2YWx1ZVByb3BlcnRpZXMuU3RydWN0IHx8IHR5cGVvZiB2YWx1ZVByb3BlcnRpZXMuU3RydWN0ICE9PSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlO1xuXG4gIGNvbnN0IHN0cnVjdFByb3BlcnRpZXMgPSB2YWx1ZVByb3BlcnRpZXMuU3RydWN0IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBpZiAoXG4gICAgdHlwZW9mIHN0cnVjdFByb3BlcnRpZXMuYWRkcmVzcyAhPT0gJ3N0cmluZycgfHxcbiAgICB0eXBlb2Ygc3RydWN0UHJvcGVydGllcy5tb2R1bGUgIT09ICdzdHJpbmcnIHx8XG4gICAgdHlwZW9mIHN0cnVjdFByb3BlcnRpZXMubmFtZSAhPT0gJ3N0cmluZycgfHxcbiAgICAhQXJyYXkuaXNBcnJheShzdHJ1Y3RQcm9wZXJ0aWVzLnR5cGVBcmd1bWVudHMpIHx8XG4gICAgIXN0cnVjdFByb3BlcnRpZXMudHlwZUFyZ3VtZW50cy5ldmVyeSgodmFsdWUpID0+IGlzU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKHZhbHVlKSlcbiAgKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8vIE5PVEU6IFRoaXMgdHlwZSBpcyByZWN1cnNpdmUsIHNvIHdlIG5lZWQgdG8gbWFudWFsbHkgaW1wbGVtZW50IGl0OlxuZXhwb3J0IGNvbnN0IFN1aU1vdmVOb3JtYWxpemVkU3RydWN0VHlwZSA9IGRlZmluZTxTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGU+KFxuICAnU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3RUeXBlJyxcbiAgaXNTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGVcbik7XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZEZ1bmN0aW9uID0gb2JqZWN0KHtcbiAgdmlzaWJpbGl0eTogU3VpTW92ZVZpc2liaWxpdHksXG4gIGlzRW50cnk6IGJvb2xlYW4oKSxcbiAgdHlwZVBhcmFtZXRlcnM6IGFycmF5KFN1aU1vdmVBYmlsaXR5U2V0KSxcbiAgcGFyYW1ldGVyczogYXJyYXkoU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKSxcbiAgcmV0dXJuOiBhcnJheShTdWlNb3ZlTm9ybWFsaXplZFR5cGUpLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTm9ybWFsaXplZEZ1bmN0aW9uID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVOb3JtYWxpemVkRnVuY3Rpb24+O1xuXG5leHBvcnQgY29uc3QgU3VpTW92ZU5vcm1hbGl6ZWRGaWVsZCA9IG9iamVjdCh7XG4gIG5hbWU6IHN0cmluZygpLFxuICB0eXBlOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUsXG59KTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkRmllbGQgPSBJbmZlcjx0eXBlb2YgU3VpTW92ZU5vcm1hbGl6ZWRGaWVsZD47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdCA9IG9iamVjdCh7XG4gIGFiaWxpdGllczogU3VpTW92ZUFiaWxpdHlTZXQsXG4gIHR5cGVQYXJhbWV0ZXJzOiBhcnJheShTdWlNb3ZlU3RydWN0VHlwZVBhcmFtZXRlciksXG4gIGZpZWxkczogYXJyYXkoU3VpTW92ZU5vcm1hbGl6ZWRGaWVsZCksXG59KTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkU3RydWN0ID0gSW5mZXI8dHlwZW9mIFN1aU1vdmVOb3JtYWxpemVkU3RydWN0PjtcblxuZXhwb3J0IGNvbnN0IFN1aU1vdmVOb3JtYWxpemVkTW9kdWxlID0gb2JqZWN0KHtcbiAgZmlsZUZvcm1hdFZlcnNpb246IG51bWJlcigpLFxuICBhZGRyZXNzOiBzdHJpbmcoKSxcbiAgbmFtZTogc3RyaW5nKCksXG4gIGZyaWVuZHM6IGFycmF5KFN1aU1vdmVNb2R1bGVJZCksXG4gIHN0cnVjdHM6IHJlY29yZChzdHJpbmcoKSwgU3VpTW92ZU5vcm1hbGl6ZWRTdHJ1Y3QpLFxuICBleHBvc2VkRnVuY3Rpb25zOiByZWNvcmQoc3RyaW5nKCksIFN1aU1vdmVOb3JtYWxpemVkRnVuY3Rpb24pLFxufSk7XG5leHBvcnQgdHlwZSBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZSA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZT47XG5cbmV4cG9ydCBjb25zdCBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZXMgPSByZWNvcmQoc3RyaW5nKCksIFN1aU1vdmVOb3JtYWxpemVkTW9kdWxlKTtcbmV4cG9ydCB0eXBlIFN1aU1vdmVOb3JtYWxpemVkTW9kdWxlcyA9IEluZmVyPHR5cGVvZiBTdWlNb3ZlTm9ybWFsaXplZE1vZHVsZXM+O1xuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdE11dGFibGVSZWZlcmVuY2Uobm9ybWFsaXplZFR5cGU6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSk6IFN1aU1vdmVOb3JtYWxpemVkVHlwZSB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiB0eXBlb2Ygbm9ybWFsaXplZFR5cGUgPT09ICdvYmplY3QnICYmICdNdXRhYmxlUmVmZXJlbmNlJyBpbiBub3JtYWxpemVkVHlwZVxuICAgID8gbm9ybWFsaXplZFR5cGUuTXV0YWJsZVJlZmVyZW5jZVxuICAgIDogdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXh0cmFjdFJlZmVyZW5jZShub3JtYWxpemVkVHlwZTogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlKTogU3VpTW92ZU5vcm1hbGl6ZWRUeXBlIHwgdW5kZWZpbmVkIHtcbiAgcmV0dXJuIHR5cGVvZiBub3JtYWxpemVkVHlwZSA9PT0gJ29iamVjdCcgJiYgJ1JlZmVyZW5jZScgaW4gbm9ybWFsaXplZFR5cGUgPyBub3JtYWxpemVkVHlwZS5SZWZlcmVuY2UgOiB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0U3RydWN0VGFnKG5vcm1hbGl6ZWRUeXBlOiBTdWlNb3ZlTm9ybWFsaXplZFR5cGUpOiBTdWlNb3ZlTm9ybWFsaXplZFN0cnVjdFR5cGUgfCB1bmRlZmluZWQge1xuICBpZiAodHlwZW9mIG5vcm1hbGl6ZWRUeXBlID09PSAnb2JqZWN0JyAmJiAnU3RydWN0JyBpbiBub3JtYWxpemVkVHlwZSkge1xuICAgIHJldHVybiBub3JtYWxpemVkVHlwZTtcbiAgfVxuXG4gIGNvbnN0IHJlZiA9IGV4dHJhY3RSZWZlcmVuY2Uobm9ybWFsaXplZFR5cGUpO1xuICBjb25zdCBtdXRSZWYgPSBleHRyYWN0TXV0YWJsZVJlZmVyZW5jZShub3JtYWxpemVkVHlwZSk7XG5cbiAgaWYgKHR5cGVvZiByZWYgPT09ICdvYmplY3QnICYmICdTdHJ1Y3QnIGluIHJlZikge1xuICAgIHJldHVybiByZWY7XG4gIH1cblxuICBpZiAodHlwZW9mIG11dFJlZiA9PT0gJ29iamVjdCcgJiYgJ1N0cnVjdCcgaW4gbXV0UmVmKSB7XG4gICAgcmV0dXJuIG11dFJlZjtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuIl19