"use strict";
/**
 * Defines input sizes for BitGo signature scripts.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.inputComponentsP2shP2pk = exports.inputComponentsP2trScriptSpendLevel2 = exports.inputComponentsP2trScriptSpendLevel1 = exports.inputComponentsP2trKeySpend = exports.inputComponentsP2wsh = exports.inputComponentsP2shP2wsh = exports.inputComponentsP2sh = exports.getInputComponentsWeight = exports.getInputWeight = exports.getInputByteLength = exports.varSliceSize = void 0;
const varuint_bitcoin_1 = __importDefault(require("varuint-bitcoin"));
function varSliceSize(someScript) {
    const length = someScript.length;
    return varuint_bitcoin_1.default.encodingLength(length) + length;
}
exports.varSliceSize = varSliceSize;
function vectorSize(someVector) {
    const length = someVector.length;
    return (varuint_bitcoin_1.default.encodingLength(length) +
        someVector.reduce((sum, witness) => {
            return sum + varSliceSize(witness);
        }, 0));
}
function getInputByteLength(input, allowWitness) {
    return (40 /* inputId(32), index(4), nSequence(4) */ +
        varSliceSize(input.script) +
        (allowWitness ? vectorSize(input.witness) : 0));
}
exports.getInputByteLength = getInputByteLength;
function getInputWeight(input) {
    return 3 * getInputByteLength(input, false) + getInputByteLength(input, true);
}
exports.getInputWeight = getInputWeight;
function getInputComponentsWeight(c) {
    const scriptSize = c.script.reduce((a, b) => a + b, 0);
    return getInputWeight({
        script: { length: scriptSize },
        witness: c.witness.map((v) => ({ length: v })),
    });
}
exports.getInputComponentsWeight = getInputComponentsWeight;
const opSize = 1;
const op0Size = opSize;
const opPushSize = opSize;
const opCheckSigVerifySize = opSize;
const opCheckSigSize = opSize;
const ecdsaSignatureSize = 72;
const schnorrPubkeySize = 32;
const schnorrSignatureNoSighashSize = 64;
const p2msPubScriptSize = 105; // Note: This is valid for a compressed public key only
const p2wshPubScriptSize = 34;
const p2pkPubScriptSize = 35;
function p2trScriptSpend(level) {
    return [
        schnorrSignatureNoSighashSize,
        schnorrSignatureNoSighashSize,
        opPushSize + schnorrPubkeySize + opCheckSigSize + opPushSize + schnorrPubkeySize + opCheckSigVerifySize,
        /* header byte */ 1 + /* inner key */ 32 + /* inner leaf */ 32 * level,
    ];
}
function p2msSigScriptSize(witness) {
    return [
        witness ? 0 : op0Size,
        (witness ? 0 : opPushSize) + ecdsaSignatureSize,
        (witness ? 0 : opPushSize) + ecdsaSignatureSize,
        (witness ? 0 : /* OP_PUSHDATA2 */ opPushSize + 1) + p2msPubScriptSize,
    ];
}
exports.inputComponentsP2sh = {
    script: p2msSigScriptSize(false),
    witness: [],
};
exports.inputComponentsP2shP2wsh = {
    script: [opSize + p2wshPubScriptSize],
    witness: p2msSigScriptSize(true),
};
exports.inputComponentsP2wsh = {
    script: [],
    witness: p2msSigScriptSize(true),
};
// See: https://murchandamus.medium.com/2-of-3-multisig-inputs-using-pay-to-taproot-d5faf2312ba3
exports.inputComponentsP2trKeySpend = {
    script: [],
    witness: [schnorrSignatureNoSighashSize],
};
exports.inputComponentsP2trScriptSpendLevel1 = {
    script: [],
    witness: p2trScriptSpend(1),
};
exports.inputComponentsP2trScriptSpendLevel2 = {
    script: [],
    witness: p2trScriptSpend(2),
};
exports.inputComponentsP2shP2pk = {
    script: [opPushSize + ecdsaSignatureSize, opPushSize + p2pkPubScriptSize],
    witness: [],
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXRXZWlnaHRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2lucHV0V2VpZ2h0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7Ozs7OztBQUVILHNFQUFzQztBQUV0QyxTQUFnQixZQUFZLENBQUMsVUFBaUI7SUFDNUMsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQztJQUVqQyxPQUFPLHlCQUFPLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQztBQUNqRCxDQUFDO0FBSkQsb0NBSUM7QUFFRCxTQUFTLFVBQVUsQ0FBQyxVQUFtQjtJQUNyQyxNQUFNLE1BQU0sR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDO0lBRWpDLE9BQU8sQ0FDTCx5QkFBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUM7UUFDOUIsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsRUFBRTtZQUNqQyxPQUFPLEdBQUcsR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUNOLENBQUM7QUFDSixDQUFDO0FBV0QsU0FBZ0Isa0JBQWtCLENBQUMsS0FBWSxFQUFFLFlBQXFCO0lBQ3BFLE9BQU8sQ0FDTCxFQUFFLENBQUMseUNBQXlDO1FBQzVDLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzFCLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDL0MsQ0FBQztBQUNKLENBQUM7QUFORCxnREFNQztBQUVELFNBQWdCLGNBQWMsQ0FBQyxLQUFZO0lBQ3pDLE9BQU8sQ0FBQyxHQUFHLGtCQUFrQixDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENB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Q0FBQztDQUM1QixDQUFDO0FBRVcsUUFBQSxvQ0FBb0MsR0FBb0I7SUFDbkUsTUFBTSxFQUFFLEVBQUU7SUFDVixPQUFPLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQztDQUM1QixDQUFDO0FBRVcsUUFBQSx1QkFBdUIsR0FBb0I7SUFDdEQsTUFBTSxFQUFFLENBQUMsVUFBVSxHQUFHLGtCQUFrQixFQUFFLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQztJQUN6RSxPQUFPLEVBQUUsRUFBRTtDQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERlZmluZXMgaW5wdXQgc2l6ZXMgZm9yIEJpdEdvIHNpZ25hdHVyZSBzY3JpcHRzLlxuICovXG5cbmltcG9ydCB2YXJ1aW50IGZyb20gJ3ZhcnVpbnQtYml0Y29pbic7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YXJTbGljZVNpemUoc29tZVNjcmlwdDogU2l6ZWQpOiBudW1iZXIge1xuICBjb25zdCBsZW5ndGggPSBzb21lU2NyaXB0Lmxlbmd0aDtcblxuICByZXR1cm4gdmFydWludC5lbmNvZGluZ0xlbmd0aChsZW5ndGgpICsgbGVuZ3RoO1xufVxuXG5mdW5jdGlvbiB2ZWN0b3JTaXplKHNvbWVWZWN0b3I6IFNpemVkW10pOiBudW1iZXIge1xuICBjb25zdCBsZW5ndGggPSBzb21lVmVjdG9yLmxlbmd0aDtcblxuICByZXR1cm4gKFxuICAgIHZhcnVpbnQuZW5jb2RpbmdMZW5ndGgobGVuZ3RoKSArXG4gICAgc29tZVZlY3Rvci5yZWR1Y2UoKHN1bSwgd2l0bmVzcykgPT4ge1xuICAgICAgcmV0dXJuIHN1bSArIHZhclNsaWNlU2l6ZSh3aXRuZXNzKTtcbiAgICB9LCAwKVxuICApO1xufVxuXG5leHBvcnQgdHlwZSBTaXplZCA9IHtcbiAgbGVuZ3RoOiBudW1iZXI7XG59O1xuXG5leHBvcnQgdHlwZSBJbnB1dCA9IHtcbiAgc2NyaXB0OiBTaXplZDtcbiAgd2l0bmVzczogU2l6ZWRbXTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbnB1dEJ5dGVMZW5ndGgoaW5wdXQ6IElucHV0LCBhbGxvd1dpdG5lc3M6IGJvb2xlYW4pOiBudW1iZXIge1xuICByZXR1cm4gKFxuICAgIDQwIC8qIGlucHV0SWQoMzIpLCBpbmRleCg0KSwgblNlcXVlbmNlKDQpICovICtcbiAgICB2YXJTbGljZVNpemUoaW5wdXQuc2NyaXB0KSArXG4gICAgKGFsbG93V2l0bmVzcyA/IHZlY3RvclNpemUoaW5wdXQud2l0bmVzcykgOiAwKVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5wdXRXZWlnaHQoaW5wdXQ6IElucHV0KTogbnVtYmVyIHtcbiAgcmV0dXJuIDMgKiBnZXRJbnB1dEJ5dGVMZW5ndGgoaW5wdXQsIGZhbHNlKSArIGdldElucHV0Qnl0ZUxlbmd0aChpbnB1dCwgdHJ1ZSk7XG59XG5cbmV4cG9ydCB0eXBlIElucHV0Q29tcG9uZW50cyA9IHtcbiAgc2NyaXB0OiBudW1iZXJbXTtcbiAgd2l0bmVzczogbnVtYmVyW107XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SW5wdXRDb21wb25lbnRzV2VpZ2h0KGM6IElucHV0Q29tcG9uZW50cyk6IG51bWJlciB7XG4gIGNvbnN0IHNjcmlwdFNpemUgPSBjLnNjcmlwdC5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgcmV0dXJuIGdldElucHV0V2VpZ2h0KHtcbiAgICBzY3JpcHQ6IHsgbGVuZ3RoOiBzY3JpcHRTaXplIH0sXG4gICAgd2l0bmVzczogYy53aXRuZXNzLm1hcCgodikgPT4gKHsgbGVuZ3RoOiB2IH0pKSxcbiAgfSk7XG59XG5cbmNvbnN0IG9wU2l6ZSA9IDE7XG5jb25zdCBvcDBTaXplID0gb3BTaXplO1xuY29uc3Qgb3BQdXNoU2l6ZSA9IG9wU2l6ZTtcbmNvbnN0IG9wQ2hlY2tTaWdWZXJpZnlTaXplID0gb3BTaXplO1xuY29uc3Qgb3BDaGVja1NpZ1NpemUgPSBvcFNpemU7XG5jb25zdCBlY2RzYVNpZ25hdHVyZVNpemUgPSA3MjtcbmNvbnN0IHNjaG5vcnJQdWJrZXlTaXplID0gMzI7XG5jb25zdCBzY2hub3JyU2lnbmF0dXJlTm9TaWdoYXNoU2l6ZSA9IDY0O1xuY29uc3QgcDJtc1B1YlNjcmlwdFNpemUgPSAxMDU7IC8vIE5vdGU6IFRoaXMgaXMgdmFsaWQgZm9yIGEgY29tcHJlc3NlZCBwdWJsaWMga2V5IG9ubHlcbmNvbnN0IHAyd3NoUHViU2NyaXB0U2l6ZSA9IDM0O1xuY29uc3QgcDJwa1B1YlNjcmlwdFNpemUgPSAzNTtcblxuZnVuY3Rpb24gcDJ0clNjcmlwdFNwZW5kKGxldmVsOiAxIHwgMik6IG51bWJlcltdIHtcbiAgcmV0dXJuIFtcbiAgICBzY2hub3JyU2lnbmF0dXJlTm9TaWdoYXNoU2l6ZSxcbiAgICBzY2hub3JyU2lnbmF0dXJlTm9TaWdoYXNoU2l6ZSxcbiAgICBvcFB1c2hTaXplICsgc2Nobm9yclB1YmtleVNpemUgKyBvcENoZWNrU2lnU2l6ZSArIG9wUHVzaFNpemUgKyBzY2hub3JyUHVia2V5U2l6ZSArIG9wQ2hlY2tTaWdWZXJpZnlTaXplLFxuICAgIC8qIGhlYWRlciBieXRlICovIDEgKyAvKiBpbm5lciBrZXkgKi8gMzIgKyAvKiBpbm5lciBsZWFmICovIDMyICogbGV2ZWwsXG4gIF07XG59XG5cbmZ1bmN0aW9uIHAybXNTaWdTY3JpcHRTaXplKHdpdG5lc3M6IGJvb2xlYW4pIHtcbiAgcmV0dXJuIFtcbiAgICB3aXRuZXNzID8gMCA6IG9wMFNpemUsXG4gICAgKHdpdG5lc3MgPyAwIDogb3BQdXNoU2l6ZSkgKyBlY2RzYVNpZ25hdHVyZVNpemUsXG4gICAgKHdpdG5lc3MgPyAwIDogb3BQdXNoU2l6ZSkgKyBlY2RzYVNpZ25hdHVyZVNpemUsXG4gICAgKHdpdG5lc3MgPyAwIDogLyogT1BfUFVTSERBVEEyICovIG9wUHVzaFNpemUgKyAxKSArIHAybXNQdWJTY3JpcHRTaXplLFxuICBdO1xufVxuXG5leHBvcnQgY29uc3QgaW5wdXRDb21wb25lbnRzUDJzaDogSW5wdXRDb21wb25lbnRzID0ge1xuICBzY3JpcHQ6IHAybXNTaWdTY3JpcHRTaXplKGZhbHNlKSxcbiAgd2l0bmVzczogW10sXG59O1xuXG5leHBvcnQgY29uc3QgaW5wdXRDb21wb25lbnRzUDJzaFAyd3NoOiBJbnB1dENvbXBvbmVudHMgPSB7XG4gIHNjcmlwdDogW29wU2l6ZSArIHAyd3NoUHViU2NyaXB0U2l6ZV0sXG4gIHdpdG5lc3M6IHAybXNTaWdTY3JpcHRTaXplKHRydWUpLFxufTtcblxuZXhwb3J0IGNvbnN0IGlucHV0Q29tcG9uZW50c1Ayd3NoOiBJbnB1dENvbXBvbmVudHMgPSB7XG4gIHNjcmlwdDogW10sXG4gIHdpdG5lc3M6IHAybXNTaWdTY3JpcHRTaXplKHRydWUpLFxufTtcblxuLy8gU2VlOiBodHRwczovL211cmNoYW5kYW11cy5tZWRpdW0uY29tLzItb2YtMy1tdWx0aXNpZy1pbnB1dHMtdXNpbmctcGF5LXRvLXRhcHJvb3QtZDVmYWYyMzEyYmEzXG5leHBvcnQgY29uc3QgaW5wdXRDb21wb25lbnRzUDJ0cktleVNwZW5kOiBJbnB1dENvbXBvbmVudHMgPSB7XG4gIHNjcmlwdDogW10sXG4gIHdpdG5lc3M6IFtzY2hub3JyU2lnbmF0dXJlTm9TaWdoYXNoU2l6ZV0sXG59O1xuXG5leHBvcnQgY29uc3QgaW5wdXRDb21wb25lbnRzUDJ0clNjcmlwdFNwZW5kTGV2ZWwxOiBJbnB1dENvbXBvbmVudHMgPSB7XG4gIHNjcmlwdDogW10sXG4gIHdpdG5lc3M6IHAydHJTY3JpcHRTcGVuZCgxKSxcbn07XG5cbmV4cG9ydCBjb25zdCBpbnB1dENvbXBvbmVudHNQMnRyU2NyaXB0U3BlbmRMZXZlbDI6IElucHV0Q29tcG9uZW50cyA9IHtcbiAgc2NyaXB0OiBbXSxcbiAgd2l0bmVzczogcDJ0clNjcmlwdFNwZW5kKDIpLFxufTtcblxuZXhwb3J0IGNvbnN0IGlucHV0Q29tcG9uZW50c1Ayc2hQMnBrOiBJbnB1dENvbXBvbmVudHMgPSB7XG4gIHNjcmlwdDogW29wUHVzaFNpemUgKyBlY2RzYVNpZ25hdHVyZVNpemUsIG9wUHVzaFNpemUgKyBwMnBrUHViU2NyaXB0U2l6ZV0sXG4gIHdpdG5lc3M6IFtdLFxufTtcbiJdfQ==